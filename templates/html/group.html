<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Name}}</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/groupstyle.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg custom-navbar navbar-dark">
        <a class="navbar-brand" href="/">Groupie-tracker</a>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-6">
                <h1>{{.Name}}</h1>
                <img src="{{.Image}}" alt="{{.Name}} Image" class="img-fluid">
            </div>
            <div class="col-md-6 details-section">
                <h2>Date of creation:</h2>
                <p>{{.CreationDate}}</p>

                <h2>Members:</h2>
                <ul>
                    {{range .Members}}
                    <li>{{.}}</li>
                    {{end}}
                </ul>

                <h2>First Album:</h2>
                <p>{{.FirstAlbum}}</p>

                <div class="concert-info">
                    <h2>Date and location</h2>
                    <ul>
                        {{ range .ConcertData }}
                        <div class="loc">
                            <li><strong>{{ .Location }}</strong>
                        </div>
                        <ul>
                            {{ range .Dates }}
                            <li>{{ . }}</li>
                            {{ end }}
                        </ul>
                        </li>
                        {{ end }}
                    </ul>
                </div>
            </div>
        </div>

        <div id="googleMap" style="width:100%; height:600px;margin: 40px;"></div>

        <div class="mt-4">
            <a href="/" class="btn btn-primary">Back to All Groups</a>
        </div>
    </div>


    <footer>
        <div class="container">
            <p>&copy; 2023 Authors: kamamedov, akalbiat</p>
        </div>
    </footer>


    <script>
        let loc = document.getElementsByClassName('loc');
        console.log(loc);
        let arr = []
        for (key of loc) {
            arr.push(key.innerHTML.replace(/[^\w\s]|_/g, " "));
        }
        var map
        function myMap() {
            var geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(51.508742, -0.120850);
            var mapOptions = {
                zoom: 3,
                center: latlng
            }
            map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);
            for (key of arr) {
                geocoder.geocode({
                    'address': key
                }, function (results, status) {
                    if (status == 'OK') {
                        map.setCenter(results[0].geometry.location);
                        let marker = new google.maps.Marker({
                            map: map,
                            animation: google.maps.Animation.BOUNCE,
                            position: results[0].geometry.location
                        });
                        const infowindow = new google.maps.InfoWindow({
                            content: "<p>Marker Location:" + marker.getPosition() + "</p>",
                        });
                        google.maps.event.addListener(marker, "click", () => {
                            infowindow.open(map, marker);
                        });
                        google.maps.event.addListener(marker, 'click', function () {
                            var pos = map.getZoom();
                            map.setZoom(9);
                            map.setCenter(marker.getPosition());
                            window.setTimeout(function () {
                                map.setZoom(pos);
                            }, 3000);
                        })
                    } else {
                        console.log("Don't work because:" + status)
                    }
                })
            }
        }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ65aafPZP_EQ6292Zb-5_GvZsKG_RE68&callback=myMap"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>